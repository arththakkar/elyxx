<section id="page-title">
	<div class="container clearfix">
		<h1><%= @category.name %></h1>
		<span>What will you display?</span>
	</div>
	<div class="page-title-border"></div>
</section>

<section id="content">
	<div class="content-wrap">
		<div class="container clearfix">
			<div class="row">
				<div class="col-md-3">
					<article class="portfolio-item pf-illustrations">
						<div class="portfolio-image">
							<a href="#">
								<img src="/images/800550/1.jpg" alt="Locked Steel Gate">
							</a>
						</div>
						<div class="portfolio-desc center">
							
							<h3><a href="#">Image Description</a></h3>
							<%= link_to "Display", "#", class: "button button-xlarge button-rounded castme", data: { image_id: 1 } %>
							<!--  <span><a href="#">Illustrations</a></span> -->
						</div>
					</article>
				</div>

				<div class="col-md-3">
					<article class="portfolio-item pf-illustrations">
						<div class="portfolio-image">
							<a href="#">
								<img src="/images/800550/2.jpg" alt="Locked Steel Gate">
							</a>
						</div>
						<div class="portfolio-desc center">
							
							<h3><a href="#">Image Description</a></h3>
							<%= link_to "Display", "#", class: "button button-xlarge button-rounded castme", data: { image_id: 2 } %>
							<!--  <span><a href="#">Illustrations</a></span> -->
						</div>
					</article>
				</div>

				<div class="col-md-3">
					<article class="portfolio-item pf-illustrations">
						<div class="portfolio-image">
							<a href="#">
								<img src="/images/800550/3.jpg" alt="Locked Steel Gate">
							</a>
						</div>
						<div class="portfolio-desc center">
							
							<h3><a href="#">Image Description</a></h3>
							<%= link_to "Display", "#", class: "button button-xlarge button-rounded castme", data: { image_id: 3 } %>
							<!--  <span><a href="#">Illustrations</a></span> -->
						</div>
					</article>
				</div>
			
				<div class="col-md-3">
					<article class="portfolio-item pf-illustrations">
						<div class="portfolio-image">
							<a href="#">
								<img src="/images/800550/4.jpg" alt="Locked Steel Gate">
							</a>
						</div>
						<div class="portfolio-desc center">
							
							<h3><a href="#">Image Description</a></h3>
							<%= link_to "Display", "#", class: "button button-xlarge button-rounded castme", data: { image_id: 4 } %>
							<!--  <span><a href="#">Illustrations</a></span> -->
						</div>
					</article>
				</div>
			</div>
			<div class="row">
				<div class="col-md-3">
					<article class="portfolio-item pf-illustrations">
						<div class="portfolio-image">
							<a href="#">
								<img src="/images/800550/5.jpg" alt="Locked Steel Gate">
							</a>
						</div>
						<div class="portfolio-desc center">
							
							<h3><a href="#">Image Description</a></h3>
							<%= link_to "Display", "#", class: "button button-xlarge button-rounded castme", data: { image_id: 5 } %>
							<!--  <span><a href="#">Illustrations</a></span> -->
						</div>
					</article>
				</div>
			</div>
		</div>
	</div>
</section>
<script type="text/javascript" src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js"></script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
<script type="text/javascript">
	var session = null;
var image_name = null;

$(document).ready(function(){
  var loadCastInterval = setInterval(function(){
    if (chrome.cast.isAvailable) {
      console.log('Cast has loaded.');
      clearInterval(loadCastInterval);
      initializeCastApi();
    } else {
      console.log('Unavailable');
    }
  }, 1000);
});

function initializeCastApi() {
  var applicationID = chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID;
  var sessionRequest = new chrome.cast.SessionRequest(applicationID);
  var apiConfig = new chrome.cast.ApiConfig(sessionRequest,sessionListener,receiverListener);
  chrome.cast.initialize(apiConfig, onInitSuccess, onInitError);
};

function sessionListener(e) {
  session = e;
  console.log('New session');
  if (session.media.length != 0) {
    console.log('Found ' + session.media.length + ' sessions.');
  }
}

function receiverListener(e) {
  if( e === 'available' ) {
    console.log("Chromecast was found on the network.");
  }
  else {
    console.log("There are no Chromecasts available.");
  }
}

function onInitSuccess() {
  console.log("Initialization succeeded");
}

function onInitError() {
  console.log("Initialization failed");
}

$('.castme').click(function(){
  image_name = $(this).data("image-id");
  launchApp();
});

function launchApp() {
  console.log("Launching the Chromecast App...");
  chrome.cast.requestSession(onRequestSessionSuccess, onLaunchError);
}

function onRequestSessionSuccess(e) {
  console.log("Successfully created session: " + e.sessionId);
  session = e;
}

function onLaunchError() {
  console.log("Error connecting to the Chromecast.");
}

function onRequestSessionSuccess(e) {
  console.log("Successfully created session: " + e.sessionId);
  session = e;
  loadMedia();
}

function loadMedia() {
  if (!session) {
    console.log("No session.");
    return;
  }
  var mediaInfo = new chrome.cast.media.MediaInfo('http://elyxx.herokuapp.com/images/'+image_name+'.jpg');
  mediaInfo.contentType = 'image/jpg';
  
  var request = new chrome.cast.media.LoadRequest(mediaInfo);
  request.autoplay = true;

  session.loadMedia(request, onLoadSuccess, onLoadError);
}

function onLoadSuccess() {
  console.log('Successfully loaded image.');
}

function onLoadError() {
  console.log('Failed to load image.');
}

</script>